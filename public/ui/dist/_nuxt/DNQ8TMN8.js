import{_ as I}from"./DYA8yp-Y.js";import{_ as F}from"./vC7ySrY7.js";/* empty css        */import{_ as O}from"./DfUOK2DD.js";import{_ as V}from"./ZlaTK1bf.js";import{c as $}from"./CwrragXr.js";import{U as q,a as A,r as _,o as j,R as u,d as z,V as E,k as G,x as S,B as k,z as C,X as Q,L as N,N as a,C as L,Q as B,y as R,Y,A as H,$ as X,Z,T as J,_ as K}from"./Dh8vZoxI.js";import"./BFepS9fx.js";import"./BrqrogAf.js";const W=q("useModuleRekeningStore",()=>{const P=[{text:"No Rekening",value:"no_rekening"},{text:"Nama Rekening",value:"nama_rekening"},{text:"PT",value:"nama_pt"},{text:"Mata Uang",value:"mata_uang"},{text:"Saldo",value:"total_saldo_formatted"}],{$apiFetch:e}=A(),h=_([]),v=localStorage.getItem("token"),t=_(!0),y={id:0,no_rekening:"",nama_rekening:"",nama_pt:"",mata_uang:"",total_saldo:0},x=_([]),o=_($(y));function D(l){o.value=l}const g=async({no_rekening:l="",nama_rekening:s="",id_pt:c=0,mata_uang:r=""}={})=>{const i={};l&&(i.no_rekening=l),s&&(i.nama_rekening=s),c&&(i.id_pt=String(c)),r&&(i.mata_uang=r);const w=new URLSearchParams(i).toString();try{const M=await e(`/rekening?${w}`,{headers:{Authorization:`Bearer ${v}`}});h.value=M.map(f=>{var T;return{id:f.id,no_rekening:f.no_rekening,nama_rekening:f.nama_rekening,nama_pt:((T=f.pt)==null?void 0:T.nama_pt)??"-",id_pt:f.id_pt,mata_uang:f.mata_uang??"IDR",total_saldo:f.total_saldo??0,total_saldo_formatted:new Intl.NumberFormat("id-ID",{style:"currency",currency:f.mata_uang??""}).format(f.total_saldo??0)}})}catch{u().danger("Gagal memuat data!")}},U=async()=>{t.value=!0;const{no_rekening:l,nama_rekening:s,id_pt:c,mata_uang:r}=o.value;await g({no_rekening:l||"",nama_rekening:s||"",id_pt:c||0,mata_uang:r||""}),t.value=!1,u().success("Pencarian Berhasil!")},m=async()=>{t.value=!0,o.value=$(y),await g(),await d(),t.value=!1,u().success("Form berhasil dibersihkan!")},n=async()=>{var s,c,r;if(await u().confirmDialog(`Anda ingin membuat transaksi untuk rekening ${o.value.nama_rekening}?`)){t.value=!0;try{const i=await e("/rekening",{method:"POST",headers:{"Content-Type":"application/json"},body:o.value});o.value.id=i.data.id||0,await g(),t.value=!1,u().success("Rekening berhasil dibuat!")}catch(i){const w=((r=(c=(s=i==null?void 0:i.data)==null?void 0:s.errors)==null?void 0:c[0])==null?void 0:r.message)||"Gagal membuat Rekening.";t.value=!1,u().danger(w)}}},p=async()=>{var l,s,c;if(o.value.id===0){u().warning("Pilih salah satu data dalam tabel.");return}if(!(o.value.id!==0&&!await u().confirmDialog(`Anda yakin ingin mengubah rekening ${o.value.nama_rekening}?`))){t.value=!0;try{const r=await e(`/rekening/${o.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:o.value});await g(),t.value=!1,u().success("Rekening berhasil diperbarui!")}catch(r){const i=((c=(s=(l=r==null?void 0:r.data)==null?void 0:l.errors)==null?void 0:s[0])==null?void 0:c.message)||"Gagal mengubah Rekening.";t.value=!1,u().danger(i)}}},b=async()=>{var s,c,r;if(!o.value.id){u().warning("Pilih data yang ingin dihapus.");return}if(await u().confirmDialog(`Yakin ingin menghapus rekening ${o.value.nama_rekening}?`)){t.value=!0;try{await e(`/rekening/${o.value.id}`,{method:"DELETE"}),await g(),await m(),t.value=!1,u().success("Rekening berhasil dihapus!")}catch(i){const w=((r=(c=(s=i==null?void 0:i.data)==null?void 0:s.errors)==null?void 0:c[0])==null?void 0:r.message)||"Data terhubung dengan tabel lain.";t.value=!1,u().danger(w)}}},d=async()=>{try{const l=await e("/pt");x.value=l.map(s=>({value:s.id,name:s.nama_pt}))}catch(l){console.error("Gagal mengambil data pt:",l)}};return j(()=>{g(),d(),o.value=$(y),t.value=!1}),{fetchData:g,handleDelete:b,handleUpdate:p,handleInsert:n,handleClickRow:D,handleRefresh:m,handleFind:U,PtOptions:x,form:o,headers:P,items:h,isLoading:t}}),ee={class:"grid grid-cols-2 md:grid-cols-4 gap-2 py-2"},ae={class:"grid grid-col items-center text-lg w-full"},ne={class:"divide-y divide-green-200 dark:divide-gray-600"},te=["onClick"],oe={class:"flex items-center space-x-2"},le={class:"text-sm font-medium text-gray-800 dark:text-gray-100"},se={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},ke=z({__name:"index",setup(P){const e=W(),h=_(!1),v=_("");_(null);const t=_(null),y=()=>{h.value=!1,v.value=""};E(h,async m=>{var n,p,b;m&&(await K(),(b=(p=(n=t.value)==null?void 0:n.$el)==null?void 0:p.querySelector("input"))==null||b.focus())});function x(){h.value=!0,console.log(e.items)}const o=G(()=>{const m=v.value.trim().toLowerCase();return e.PtOptions.filter(n=>n.name.toLowerCase().includes(m)).slice(0,10)}),D=m=>{e.form.nama_pt=m.name,e.form.id_pt=m.value,y()};function g(m){e.handleClickRow(m);const n=document.querySelector("main"),p={behavior:"smooth"};n&&n.scrollTo({top:n.scrollHeight,...p})}const U=[{value:"IDR",name:"IDR"},{value:"USD",name:"USD"}];return(m,n)=>{const p=I,b=F;return R(),S(B,null,[k(p,{headers:a(e).headers,items:a(e).items,"is-loading":a(e).isLoading,onClickRow:g},null,8,["headers","items","is-loading"]),C("div",ee,[k(V,{modelValue:a(e).form.no_rekening,"onUpdate:modelValue":n[0]||(n[0]=d=>a(e).form.no_rekening=d),label:"No Rekening",type:"number",placeholder:""},null,8,["modelValue"]),k(V,{modelValue:a(e).form.nama_rekening,"onUpdate:modelValue":n[1]||(n[1]=d=>a(e).form.nama_rekening=d),label:"Nama Rekening",placeholder:""},null,8,["modelValue"]),k(V,{modelValue:a(e).form.nama_pt,"onUpdate:modelValue":n[2]||(n[2]=d=>a(e).form.nama_pt=d),label:"PT",placeholder:"",readonly:"true",onClick:x},null,8,["modelValue"]),k(b,{modelValue:a(e).form.mata_uang,"onUpdate:modelValue":n[3]||(n[3]=d=>a(e).form.mata_uang=d),label:"Mata Uang",placeholder:"---Pilih Mata Uang---",options:U},null,8,["modelValue"])]),k(O,{"onClick:insert":a(e).handleInsert,"onClick:update":a(e).handleUpdate,"onClick:find":a(e).handleFind,"onClick:refresh":a(e).handleRefresh,"onClick:delete":a(e).handleDelete},null,8,["onClick:insert","onClick:update","onClick:find","onClick:refresh","onClick:delete"]),a(h)?(R(),Q(a(Z),{key:0,onClose:y},{header:L(()=>[C("div",ae,[k(V,{modelValue:a(v),"onUpdate:modelValue":n[4]||(n[4]=d=>X(v)?v.value=d:null),placeholder:"",label:"Cari PT",ref_key:"inputRef",ref:t},null,8,["modelValue"])])]),body:L(()=>[C("ul",ne,[(R(!0),S(B,null,Y(a(o),(d,l)=>(R(),S("li",{key:l,onClick:s=>D(d),class:"cursor-pointer px-4 py-2 hover:bg-green-200 dark:hover:bg-gray-500 transition rounded-md"},[C("div",oe,[C("div",le,H(d.name),1)])],8,te))),128))])]),_:1})):N("",!0),a(e).isLoading?(R(),S("div",se,[k(a(J),{color:"green",size:"12"})])):N("",!0)],64)}}});export{ke as default};
