import{_ as oe}from"./DYA8yp-Y.js";import{d as re,r as b,V as ae,X as N,N as l,y as v,W as ie,U as ue,a as de,o as se,R as f,n as ce,k as ge,x as $,B as y,z as k,L as D,a0 as q,a1 as me,C as R,Q as te,D as Y,S as H,Y as ke,A as pe,Z as fe,T as be,_ as ye}from"./Dh8vZoxI.js";import{_ as ve}from"./vC7ySrY7.js";import _e from"./BrqrogAf.js";/* empty css        */import{_ as A}from"./ZlaTK1bf.js";import{c as ee}from"./CwrragXr.js";import{f as le}from"./C8CCQvmy.js";import"./BFepS9fx.js";const he=re({__name:"fwb-input-currency",props:{modelValue:Number,label:String,placeholder:String,locale:{type:String,default:"id-ID"},currency:{type:String,default:"IDR"}},emits:["update:modelValue"],setup(L,{emit:t}){const w=L,m=t,d=b("");ae(()=>w.modelValue,u=>{d.value=C(u||0)},{immediate:!0});function C(u){return new Intl.NumberFormat(w.locale,{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2}).format(u)}function h(u){const V=Number(u.replace(/[^0-9]/g,""));m("update:modelValue",V),d.value=C(V)}return(u,V)=>(v(),N(l(ie),{"model-value":d.value,"onUpdate:modelValue":h,inputmode:"numeric",class:"p-2","input-class":"p-0 dark:text-gray-200 text-right","label-class":"pb-1 font-medium m-0 text-green-800 dark:text-gray-200",label:L.label,placeholder:L.placeholder},null,8,["model-value","label","placeholder"]))}}),xe=ue("useModuleTransaksiStore",()=>{const L=[{text:"Tanggal",value:"tanggal"},{text:"Akun",value:"nama_akun"},{text:"Keterangan",value:"keterangan"},{text:"Debit",value:"debit_raw"},{text:"Kredit",value:"kredit_raw"},{text:"Rekening",value:"nama_rekening"},{text:"Mata Uang",value:"mata_uang"},{text:"Saldo",value:"saldo_raw"},{text:"Created By",value:"user"}],t=b([]),w=new Date,m=b(!0),d=w.getFullYear()+"-"+String(w.getMonth()+1).padStart(2,"0")+"-"+String(w.getDate()).padStart(2,"0"),C={id:0,tanggal:d,tanggal_selesai:d,id_table_of_akun:"",nama_akun:"",keterangan:"",debit:0,kredit:0,nominal:0,id_rekening:"",nama_rekening:"",mata_uang:"",created_by:"",user:"",tipe:"debit"},{$apiFetch:h}=de(),u=b([]),V=b([]),z=b([]),r=b(ee(C));function J(n){r.value={id:n.id,tanggal:n.tanggal,tanggal_selesai:n.tanggal_selesai??n.tanggal,id_table_of_akun:n.id_table_of_akun,nama_akun:n.nama_akun??"",keterangan:n.keterangan,debit:S(String(n.debit)),kredit:S(String(n.kredit)),nominal:S(String(n.debit))>0?S(String(n.debit)):S(String(n.kredit)),id_rekening:n.id_rekening,nama_rekening:n.nama_rekening??"",mata_uang:n.mata_uang,created_by:n.created_by,user:n.user??"",tipe:S(String(n.debit))>0?"debit":"kredit"}}const c=async({id_rekening:n=0,keterangan:a="",id_table_of_akun:g=0,mata_uang:i="",created_by:p=0,start_tanggal:_=d,end_tanggal:M=d}={})=>{const U={id_rekening:n,keterangan:a,id_table_of_akun:g,mata_uang:i,created_by:p,start_tanggal:_,end_tanggal:M},F={};for(const T in U){const s=U[T];s!==0&&s!==""&&(F[T]=String(s))}const Z=new URLSearchParams(F).toString();try{const T=await h(`/transaksi?${Z}`,{method:"GET"});t.value=T.map(s=>({id:s.id??0,tanggal:s.tanggal??d,id_table_of_akun:s.id_table_of_akun??0,id_rekening:s.id_rekening??0,keterangan:s.keterangan??"",created_by:s.created_by??0,debit:P(s.debit)??"0,00",kredit:P(s.kredit)??"0,00",saldo:P(s.saldo)??"0,00",debit_raw:new Intl.NumberFormat("id-ID",{style:"currency",currency:s.Rekening.mata_uang??""}).format(s.debit??0),kredit_raw:new Intl.NumberFormat("id-ID",{style:"currency",currency:s.Rekening.mata_uang??""}).format(s.kredit??0),saldo_raw:new Intl.NumberFormat("id-ID",{style:"currency",currency:s.Rekening.mata_uang??""}).format(s.saldo??0),nama_akun:s.TableOfAkun.nama_akun??"",nama_rekening:s.Rekening.nama_rekening??"",user:s.User.nama??"",mata_uang:s.Rekening.mata_uang??"IDR",tipe:s.debit>0?"debit":"kredit"}))}catch{f().danger("Gagal memuat data!")}};function P(n){return isNaN(Number(n))?"0,00":Number(n).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}function S(n){const g=n.replace(/[^0-9,]/g,"").replace(",","."),i=parseFloat(g);return isNaN(i)?0:i%1===0?i:parseFloat(i.toFixed(2))}const Q=async({id_rekening:n=0,keterangan:a="",id_table_of_akun:g=0,mata_uang:i="",created_by:p=0,start_tanggal:_=d,end_tanggal:M=d}={})=>{const U={id_rekening:n,keterangan:a,id_table_of_akun:g,mata_uang:i,created_by:p,start_tanggal:_,end_tanggal:M},F={};for(const E in U){const K=U[E];K!==0&&K!==""&&(F[E]=String(K))}const Z=new URLSearchParams(F).toString(),T=localStorage.getItem("token"),s=ce().public.API_URL;try{const E=await fetch(`${s}/transaksi/export-pdf?${Z}`,{method:"GET",headers:{Authorization:`Bearer ${T}`}});if(!E.ok)throw new Error("Gagal mengunduh PDF");const K=await E.blob(),ne=window.URL.createObjectURL(K),j=document.createElement("a");j.href=ne,j.download="laporan-transaksi.pdf",document.body.appendChild(j),j.click(),document.body.removeChild(j),window.URL.revokeObjectURL(ne)}catch{f().danger("Gagal memuat data!")}},W=async()=>{m.value=!0;const{id_rekening:n,keterangan:a,id_table_of_akun:g,mata_uang:i,created_by:p,debit:_,kredit:M,tanggal:U,tanggal_selesai:F}=r.value;await c({id_rekening:n,keterangan:a,id_table_of_akun:g,mata_uang:i,created_by:p,start_tanggal:U,end_tanggal:F}),m.value=!1,f().success("Pencarian Berhasil!")},X=async()=>{m.value=!0;const{id_rekening:n,keterangan:a,id_table_of_akun:g,mata_uang:i,created_by:p,debit:_,kredit:M,tanggal:U,tanggal_selesai:F}=r.value;await Q({id_rekening:n,keterangan:a,id_table_of_akun:g,mata_uang:i,created_by:p,start_tanggal:U,end_tanggal:F}),m.value=!1,f().success("Export data berhasil!")},O=async()=>{m.value=!0,r.value=ee(C),c(),x(),G(),I(),f().success("Form berhasil dibersihkan!"),m.value=!1},B=async()=>{var g,i,p;if(!await f().confirmDialog(`Anda ingin membuat transaksi untuk akun ${r.value.nama_akun}?`))return;m.value=!0;const a=localStorage.getItem("created_by");a&&(r.value.created_by=parseInt(a)),r.value.tipe==="debit"?(r.value.debit=r.value.nominal,r.value.kredit=0):r.value.tipe==="kredit"&&(r.value.kredit=r.value.nominal,r.value.debit=0);try{const _=await h("/transaksi",{method:"POST",headers:{"Content-Type":"application/json"},body:r.value});await c(),r.value.id=_.data.id||0,m.value=!1,f().success("Transaksi berhasil dibuat!")}catch(_){const M=((p=(i=(g=_==null?void 0:_.data)==null?void 0:g.errors)==null?void 0:i[0])==null?void 0:p.message)||"Gagal membuat Transaksi.";m.value=!1,f().danger(M)}},o=async()=>{var n,a,g;if(r.value.id===0){f().warning("Pilih salah satu data dalam tabel.");return}if(!(r.value.id!==0&&!await f().confirmDialog(`Anda yakin ingin mengubah transaksi ${r.value.keterangan}?`))){try{const i=await h(`/transaksi/${r.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:r.value});f().success("Akun berhasil diperbarui!"),await c()}catch(i){const p=((g=(a=(n=i==null?void 0:i.data)==null?void 0:n.errors)==null?void 0:a[0])==null?void 0:g.message)||"Gagal mengubah Akun.";f().danger(p)}console.log(r.value)}},e=async()=>{var a,g,i;if(!r.value.id){f().warning("Pilih data yang ingin dihapus.");return}if(await f().confirmDialog(`Yakin ingin menghapus transaksi ${r.value.keterangan}?`))try{await h(`/transaksi/${r.value.id}`,{method:"DELETE"}),f().success("Akun berhasil dihapus!"),await c(),await O()}catch(p){const _=((i=(g=(a=p==null?void 0:p.data)==null?void 0:a.errors)==null?void 0:g[0])==null?void 0:i.message)||"Gagal menghapus transaksi.";f().danger(_)}},x=async()=>{try{const n=await h("/table-of-akun");u.value=n.map(a=>({value:a.id,name:a.nama_akun}))}catch(n){console.error("Gagal mengambil data akun:",n)}},I=async()=>{try{const n=await h("/rekening");V.value=n.map(a=>({value:a.id,name:a.nama_rekening}))}catch(n){console.error("Gagal mengambil data akun:",n)}},G=async()=>{try{const n=await h("/users");z.value=n.map(a=>({value:a.id,name:a.nama}))}catch(n){console.error("Gagal mengambil data akun:",n)}};return se(()=>{c(),x(),G(),I(),r.value=ee(C),m.value=!1}),{fetchData:c,handleDelete:e,handleUpdate:o,handleInsert:B,handleClickRow:J,handleClear:O,handleFind:W,handleExport:X,rekeningOptions:V,akunOptions:u,usersOptions:z,form:r,headers:L,items:t,today:d,isLoading:m}}),we={class:"flex justify-center items-center gap-4 py-4 border-b border-green-400 dark:border-gray-600"},Ce={class:"grid grid-cols-2 md:grid-cols-4 gap-2 py-2"},Ve={class:"grid grid-cols-3 md:grid-cols-4 gap-2 py-2"},Se={key:0,class:"absolute left-1/2 -translate-x-1/2 bg-gray-700 dark:bg-cyan-200 text-white dark:text-gray-800 text-xs rounded px-2 py-1 opacity-0 group-hover:opacity-80 transition-opacity z-10 w-full h-full text-center items-center"},De={class:"w-full"},Re={key:0,class:"absolute left-1/2 -translate-x-1/2 bg-gray-700 dark:bg-purple-200 text-white dark:text-gray-800 text-xs rounded px-2 py-1 opacity-0 group-hover:opacity-80 transition-opacity z-10 w-full h-full text-center items-center"},Ue={class:"w-full"},Fe={key:0,class:"absolute left-1/2 -translate-x-1/2 bg-gray-700 dark:bg-red-200 text-white dark:text-gray-800 text-xs rounded px-2 py-1 opacity-0 group-hover:opacity-80 transition-opacity z-10 w-full h-full text-center items-center"},Ie={class:"w-full"},Me={class:"grid items-center text-lg w-full"},Te={class:"divide-y divide-green-200 dark:divide-gray-600"},$e=["onClick"],Ae={class:"flex items-center space-x-2"},Ne={class:"text-sm font-medium text-gray-800 dark:text-gray-100"},Le={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Ye=re({__name:"index",setup(L){const t=xe();b("first");const w=b(!1),m=b("Tanggal");b(!1);const d=b("akun"),C=b(""),h=b(null),u=b(!0),V=b("bg-green-600"),z=()=>{w.value=!1,C.value=""},r=[{value:"",name:"Semua"},{value:"IDR",name:"IDR"},{value:"USD",name:"USD"}],J=[{value:"debit",name:"Debit"},{value:"kredit",name:"Kredit"}],c={insert:!0,find:!1,export:!1};ae(w,async o=>{var e,x,I;o&&(await ye(),(I=(x=(e=h.value)==null?void 0:e.$el)==null?void 0:x.querySelector("input"))==null||I.focus())});function P(o){t.handleClickRow(o);const e=document.querySelector("main"),x={behavior:"smooth"};e&&e.scrollTo({top:e.scrollHeight,...x})}ae(u,o=>{o?(c.export=!1,c.find=!1,c.insert=!0,m.value="Tanggal Awal"):(c.export=!0,c.find=!0,c.insert=!1,m.value="Tanggal")});function S(o){w.value=!0,d.value=o}const Q=ge(()=>{const o=C.value.trim().toLowerCase();let e=t.akunOptions;switch(d.value){case"akun":e=t.akunOptions;break;case"rekening":e=t.rekeningOptions;break;default:e=t.usersOptions;break}return e.filter(x=>x.name.toLowerCase().includes(o)).slice(0,10)}),W=o=>{d.value==="akun"?(t.form.nama_akun=o.name,t.form.id_table_of_akun=o.value):d.value==="rekening"?(t.form.nama_rekening=o.name,t.form.id_rekening=o.value):d.value==="users"&&(t.form.user=o.name,t.form.created_by=o.value),z()};function X(o){const e=["Backspace","ArrowLeft","ArrowRight","Tab","Delete","Home","End"];!/^[0-9]$/.test(o.key)&&!e.includes(o.key)&&o.preventDefault()}function O(){V.value="bg-amber-400"}function B(){V.value="bg-green-600"}return se(()=>{le("#tanggal-input",{dateFormat:"Y-m-d",onChange:(o,e)=>{t.form.tanggal=e}}),le("#tanggal-selesai",{dateFormat:"Y-m-d",onChange:(o,e)=>{t.form.tanggal_selesai=e}})}),(o,e)=>{const x=oe,I=he,G=ve,n=_e;return v(),$(te,null,[y(x,{headers:l(t).headers,items:l(t).items,"is-loading":l(t).isLoading,onClickRow:P},null,8,["headers","items","is-loading"]),k("div",we,[k("span",{class:q(u.value?"text-green-700 font-semibold dark:text-green-600":"text-gray-400 dark:text-gray-500")},"Filter Mode",2),k("button",{onClick:e[0]||(e[0]=a=>u.value=!u.value),class:q(["relative w-14 h-6 rounded-full transition-colors duration-300",u.value?V.value:"bg-white dark:bg-gray-700"])},[k("span",{class:q(["absolute top-1 left-1 w-6 h-4 rounded-full shadow-md transform transition-transform duration-300",u.value?" bg-white dark:bg-gray-700":`translate-x-6 ${V.value}`])},null,2)],2),k("span",{class:q(u.value?"text-gray-400 dark:text-gray-500":"text-green-700 font-semibold dark:text-green-600")},"Input Mode",2)]),k("div",Ce,[y(A,{modelValue:l(t).form.tanggal,"onUpdate:modelValue":e[1]||(e[1]=a=>l(t).form.tanggal=a),label:m.value,id:"tanggal-input",placeholder:""},null,8,["modelValue","label"]),u.value?(v(),N(A,{key:0,modelValue:l(t).form.tanggal_selesai,"onUpdate:modelValue":e[2]||(e[2]=a=>l(t).form.tanggal_selesai=a),label:"Tanggal Akhir",id:"tanggal-selesai",placeholder:""},null,8,["modelValue"])):D("",!0),y(A,{modelValue:l(t).form.nama_akun,"onUpdate:modelValue":e[3]||(e[3]=a=>l(t).form.nama_akun=a),label:"Akun",placeholder:"",readonly:"true",onClick:e[4]||(e[4]=a=>S("akun"))},null,8,["modelValue"]),y(A,{modelValue:l(t).form.keterangan,"onUpdate:modelValue":e[5]||(e[5]=a=>l(t).form.keterangan=a),label:"Keterangan",placeholder:""},null,8,["modelValue"]),u.value?D("",!0):(v(),N(I,{key:1,modelValue:l(t).form.nominal,"onUpdate:modelValue":e[6]||(e[6]=a=>l(t).form.nominal=a),label:"Nominal",placeholder:"",locale:"id-ID",onKeypress:e[7]||(e[7]=me(a=>S("rekening"),["enter"])),onKeydown:X},null,8,["modelValue"])),y(A,{modelValue:l(t).form.nama_rekening,"onUpdate:modelValue":e[8]||(e[8]=a=>l(t).form.nama_rekening=a),label:"Rekening",placeholder:"",readonly:"true",onClick:e[9]||(e[9]=a=>S("rekening"))},null,8,["modelValue"]),u.value?(v(),N(G,{key:2,modelValue:l(t).form.mata_uang,"onUpdate:modelValue":e[10]||(e[10]=a=>l(t).form.mata_uang=a),label:"Mata Uang",placeholder:"---Pilih Mata Uang---",options:r},null,8,["modelValue"])):D("",!0),u.value?D("",!0):(v(),N(G,{key:3,modelValue:l(t).form.tipe,"onUpdate:modelValue":e[11]||(e[11]=a=>l(t).form.tipe=a),label:"Jenis",placeholder:"---Pilih Jenis Transaksi---",options:J},null,8,["modelValue"])),u.value?(v(),N(A,{key:4,modelValue:l(t).form.user,"onUpdate:modelValue":e[12]||(e[12]=a=>l(t).form.user=a),label:"Created By",placeholder:"",readonly:"true",onClick:e[13]||(e[13]=a=>S("users"))},null,8,["modelValue"])):D("",!0)]),k("div",Ve,[y(l(H),{shadow:"",gradient:"green",onClick:l(t).handleClear},{prefix:R(()=>[y(n,{name:"material-symbols:refresh",size:"18"})]),default:R(()=>[e[15]||(e[15]=Y(" Refresh "))]),_:1,__:[15]},8,["onClick"]),k("div",{class:"relative group w-full",onMouseenter:O,onMouseleave:B},[c.insert?(v(),$("div",Se," Aktifkan Input Mode untuk Insert ")):D("",!0),k("div",De,[y(l(H),{class:"w-full",shadow:"",gradient:"teal",onClick:l(t).handleInsert,disabled:c.insert},{prefix:R(()=>[y(n,{name:"material-symbols:add-2",size:"18"})]),default:R(()=>[e[16]||(e[16]=Y(" Insert "))]),_:1,__:[16]},8,["onClick","disabled"])])],32),k("div",{class:"relative group w-full",onMouseenter:O,onMouseleave:B},[c.find?(v(),$("div",Re," Aktifkan Filter Mode untuk Find ")):D("",!0),k("div",Ue,[y(l(H),{class:"w-full",shadow:"",gradient:"purple",onClick:l(t).handleFind,disabled:c.find},{prefix:R(()=>[y(n,{name:"material-symbols:search",size:"18"})]),default:R(()=>[e[17]||(e[17]=Y(" Find "))]),_:1,__:[17]},8,["onClick","disabled"])])],32),k("div",{class:"relative group w-full",onMouseenter:O,onMouseleave:B},[c.export?(v(),$("div",Fe," Aktifkan Filter Mode untuk Export ")):D("",!0),k("div",Ie,[y(l(H),{class:"w-full",shadow:"",gradient:"red",onClick:l(t).handleExport,disabled:c.export},{prefix:R(()=>[y(n,{name:"carbon:document-pdf",size:"18"})]),default:R(()=>[e[18]||(e[18]=Y(" Export "))]),_:1,__:[18]},8,["onClick","disabled"])])],32)]),w.value?(v(),N(l(fe),{key:0,onClose:z},{header:R(()=>[k("div",Me,[y(A,{modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=a=>C.value=a),label:d.value==="akun"?"Cari Tipe Akun":d.value==="rekening"?"Cari Rekening":"Cari User",ref_key:"inputRef",ref:h},null,8,["modelValue","label"])])]),body:R(()=>[k("ul",Te,[(v(!0),$(te,null,ke(l(Q),(a,g)=>(v(),$("li",{key:g,onClick:i=>W(a),class:"cursor-pointer px-4 py-2 hover:bg-green-200 dark:hover:bg-gray-500 transition rounded-md"},[k("div",Ae,[k("div",Ne,pe(a.name),1)])],8,$e))),128))])]),_:1})):D("",!0),l(t).isLoading?(v(),$("div",Le,[y(l(be),{color:"green",size:"12"})])):D("",!0)],64)}}});export{Ye as default};
