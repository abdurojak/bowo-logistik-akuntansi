import{_ as H}from"./vC7ySrY7.js";import K from"./BrqrogAf.js";/* empty css        */import{_ as M}from"./ZlaTK1bf.js";import{c as E}from"./CwrragXr.js";import{U as X,r as b,a as Z,o as Q,R,n as J,d as W,k as ee,V as ae,x as g,z as n,L as G,X as te,N as t,Q as O,Y as P,B as l,C as y,y as c,A as x,D as T,S as B,T as ne,Z as oe,_ as re}from"./Dh8vZoxI.js";import{f as Y}from"./C8CCQvmy.js";const se=X("useModuleNeracaStore",()=>{const j=localStorage.getItem("token"),a=b([]),S=b([]),{$apiFetch:f}=Z(),i=b(!0),D=new Date,$=b([]),d=D.getFullYear()+"-"+String(D.getMonth()+1).padStart(2,"0")+"-"+String(D.getDate()).padStart(2,"0"),V={start_tanggal:d,end_tanggal:d,mata_uang:"IDR",id_rekening:""},p=b(E(V)),s=async({start_tanggal:r=d,end_tanggal:u=d,mata_uang:v="",id_rekening:w=""}={})=>{const L={start_tanggal:r,end_tanggal:u,mata_uang:v,id_rekening:w},N={};for(const h in L){const m=L[h];m!==""&&(N[h]=String(m))}const z=new URLSearchParams(N).toString();try{const h=await f(`/neraca?${z}`,{headers:{Authorization:`Bearer ${j}`}});a.value=h.hasil,console.log(h)}catch{R().danger("Gagal memuat data!")}},e=async()=>{try{const r=await f("/rekening");$.value=r.map(u=>({value:u.id,name:u.nama_rekening}))}catch(r){console.error("Gagal mengambil data akun:",r)}},_=async()=>{try{const r=await f("/tipe-akun");S.value=r}catch{R().danger("Gagal memuat data")}},k=r=>r.toLocaleString("id-ID",{style:"currency",currency:p.value.mata_uang||"IDR",minimumFractionDigits:2,maximumFractionDigits:2}),o=async({start_tanggal:r=d,end_tanggal:u=d,mata_uang:v="",id_rekening:w=""}={})=>{const L={start_tanggal:r,end_tanggal:u,mata_uang:v,id_rekening:w},N={};for(const m in L){const I=L[m];I!==""&&(N[m]=String(I))}const z=new URLSearchParams(N).toString(),h=localStorage.getItem("token");try{const m=await fetch(`${J().public.API_URL}/neraca/export?${z}`,{method:"GET",headers:{Authorization:`Bearer ${h}`}});if(!m.ok)throw new Error("Gagal mengunduh PDF");const I=await m.blob(),q=window.URL.createObjectURL(I),F=document.createElement("a");F.href=q,F.download="laporan-neraca.pdf",document.body.appendChild(F),F.click(),document.body.removeChild(F),window.URL.revokeObjectURL(q)}catch{R().danger("Gagal memuat data!")}},C=async()=>{i.value=!0;const{start_tanggal:r,end_tanggal:u,mata_uang:v,id_rekening:w}=p.value;await s({start_tanggal:r||d,end_tanggal:u||d,mata_uang:v||"",id_rekening:w||""}),i.value=!1,R().success("Pencarian berhasil!")},U=async()=>{i.value=!0;const{start_tanggal:r,end_tanggal:u,mata_uang:v,id_rekening:w}=p.value;await o({start_tanggal:r,end_tanggal:u,mata_uang:v,id_rekening:w}),i.value=!1,R().success("Export data berhasil!")},A=async()=>{i.value=!0,p.value=E(V),s(),i.value=!1,R().success("Halaman telah di refresh!")};return Q(()=>{s(),_(),e(),p.value=E(V),i.value=!1}),{fetchData:s,handleFind:C,handleRefresh:A,handleExport:U,formatNominal:k,rekeningOptions:$,items:a,form:p,isLoading:i}}),le={key:0,class:"text-center text-sm italic text-gray-500 dark:text-gray-400 mb-4 my-10"},ie={key:1},de={class:"font-bold text-green-800 mb-1 dark:text-white"},ce={class:"w-full mb-4 text-xs bg-white dark:bg-slate-800 dark:text-white"},ue={class:"p-2 w-1/2"},ge={class:"p-2 text-right w-1/4"},me={class:"p-2 text-right w-1/4"},fe={class:"font-bold border border-gray-200 dark:border-gray-600"},pe={class:"p-2 text-right w-1/4"},_e={class:"p-2 text-right w-1/4"},ke={class:"grid grid-cols-2 md:grid-cols-4 gap-2 py-2"},he={class:"grid grid-cols-3 gap-2 py-2"},ye={key:2,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},be={class:"grid items-center text-lg w-full"},ve={class:"divide-y divide-green-200 dark:divide-gray-600"},we=["onClick"],xe={class:"flex items-center space-x-2"},Se={class:"text-sm font-medium text-gray-800 dark:text-gray-100"},Fe=W({__name:"index",setup(j){const a=se(),S=b(!1),f=b(""),i=b(null);Q(()=>{Y("#tanggal-awal",{dateFormat:"Y-m-d",onChange:(s,e)=>{a.form.start_tanggal=e}}),Y("#tanggal-akhir",{dateFormat:"Y-m-d",onChange:(s,e)=>{a.form.end_tanggal=e}})});const D=[{value:"IDR",name:"IDR"},{value:"USD",name:"USD"}];function $(){S.value=!0}const d=()=>{S.value=!1,f.value=""},V=ee(()=>{const s=f.value.trim().toLowerCase();return a.rekeningOptions.filter(_=>_.name.toLowerCase().includes(s)).slice(0,10)}),p=s=>{a.form.nama_rekening=s.name,a.form.id_rekening=s.value,d()};return ae(S,async s=>{var e,_,k;s&&(await re(),(k=(_=(e=i.value)==null?void 0:e.$el)==null?void 0:_.querySelector("input"))==null||k.focus())}),(s,e)=>{const _=H,k=K;return c(),g(O,null,[Object.keys(t(a).items).length===0?(c(),g("div",le," Tidak ada data neraca untuk periode ini. ")):(c(),g("div",ie,[(c(!0),g(O,null,P(t(a).items,(o,C)=>(c(),g("div",{key:C,class:"mb-4"},[n("h3",de,x(C),1),n("table",ce,[e[7]||(e[7]=n("thead",{class:"bg-green-50 text-green-700 dark:bg-slate-700 dark:text-green-400"},[n("tr",{class:"border border-gray-200 dark:border-gray-600"},[n("th",{class:"p-2 text-left w-1/2"},"Akun"),n("th",{class:"p-2 text-right w-1/4"},"Debit"),n("th",{class:"p-2 text-right w-1/4"},"Kredit")])],-1)),n("tbody",null,[(c(!0),g(O,null,P(o.akun,(U,A)=>(c(),g("tr",{key:A,class:"border border-gray-200 dark:border-gray-600"},[n("td",ue,x(A),1),n("td",ge,x(t(a).formatNominal(U.debit)),1),n("td",me,x(t(a).formatNominal(U.kredit)),1)]))),128)),n("tr",fe,[e[6]||(e[6]=n("td",{class:"p-2 w-1/2"},"Total",-1)),n("td",pe,x(t(a).formatNominal(o.total_debit)),1),n("td",_e,x(t(a).formatNominal(o.total_kredit)),1)])])])]))),128))])),n("div",ke,[l(M,{modelValue:t(a).form.start_tanggal,"onUpdate:modelValue":e[0]||(e[0]=o=>t(a).form.start_tanggal=o),label:"Tanggal Awal",id:"tanggal-awal",placeholder:""},null,8,["modelValue"]),l(M,{modelValue:t(a).form.end_tanggal,"onUpdate:modelValue":e[1]||(e[1]=o=>t(a).form.end_tanggal=o),label:"Tanggal Akhir",id:"tanggal-akhir",placeholder:""},null,8,["modelValue"]),l(_,{modelValue:t(a).form.mata_uang,"onUpdate:modelValue":e[2]||(e[2]=o=>t(a).form.mata_uang=o),label:"Mata Uang",placeholder:"---Pilih Mata Uang---",options:D},null,8,["modelValue"]),l(M,{modelValue:t(a).form.nama_rekening,"onUpdate:modelValue":e[3]||(e[3]=o=>t(a).form.nama_rekening=o),label:"Rekening",placeholder:"",readonly:"true",onClick:e[4]||(e[4]=o=>$())},null,8,["modelValue"])]),n("div",he,[l(t(B),{shadow:"",gradient:"green",onClick:t(a).handleRefresh},{prefix:y(()=>[l(k,{name:"material-symbols:refresh",size:"18"})]),default:y(()=>[e[8]||(e[8]=T(" Refresh "))]),_:1,__:[8]},8,["onClick"]),l(t(B),{shadow:"",gradient:"purple",onClick:t(a).handleFind},{prefix:y(()=>[l(k,{name:"material-symbols:search",size:"18"})]),default:y(()=>[e[9]||(e[9]=T(" Find "))]),_:1,__:[9]},8,["onClick"]),l(t(B),{shadow:"",gradient:"red",onClick:t(a).handleExport},{prefix:y(()=>[l(k,{name:"carbon:document-pdf",size:"18"})]),default:y(()=>[e[10]||(e[10]=T(" Export "))]),_:1,__:[10]},8,["onClick"])]),t(a).isLoading?(c(),g("div",ye,[l(t(ne),{color:"green",size:"12"})])):G("",!0),S.value?(c(),te(t(oe),{key:3,onClose:d},{header:y(()=>[n("div",be,[l(M,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=o=>f.value=o),label:"Cari Rekening",ref_key:"inputRef",ref:i},null,8,["modelValue"])])]),body:y(()=>[n("ul",ve,[(c(!0),g(O,null,P(t(V),(o,C)=>(c(),g("li",{key:C,onClick:U=>p(o),class:"cursor-pointer px-4 py-2 hover:bg-green-200 dark:hover:bg-gray-500 transition rounded-md"},[n("div",xe,[n("div",Se,x(o.name),1)])],8,we))),128))])]),_:1})):G("",!0)],64)}}});export{Fe as default};
