import{_ as X}from"./vC7ySrY7.js";import Z from"./BrqrogAf.js";/* empty css        */import{_ as T}from"./ZlaTK1bf.js";import{c as M}from"./CwrragXr.js";import{U as J,r as m,a as W,o as K,R as I,n as ee,d as te,k as ae,V as ne,x as g,z as t,L as q,X as re,N as r,Q as B,Y as N,A as y,B as u,C as _,y as i,D as z,S as A,T as oe,Z as se,_ as le}from"./Dh8vZoxI.js";import{f as G}from"./C8CCQvmy.js";const de=J("useModuleLabaRugiStore",()=>{const P=m([]),a=m([]),h=m(""),x=m(""),S=m(""),F=m([]),$=localStorage.getItem("token"),{$apiFetch:C}=W(),p=m(!0),D=new Date,o=D.getFullYear()+"-"+String(D.getMonth()+1).padStart(2,"0")+"-"+String(D.getDate()).padStart(2,"0"),e={start_tanggal:o,end_tanggal:o,mata_uang:"IDR",id_rekening:""},s=m(M(e)),b=async()=>{try{const l=await C("/rekening");F.value=l.map(k=>({value:k.id,name:k.nama_rekening}))}catch(l){console.error("Gagal mengambil data akun:",l)}},n=async({start_tanggal:l=o,end_tanggal:k=o,mata_uang:w="",id_rekening:R=""}={})=>{const V={start_tanggal:l,end_tanggal:k,mata_uang:w,id_rekening:R},L={};for(const c in V){const d=V[c];d!==""&&(L[c]=String(d))}const O=new URLSearchParams(L).toString();try{const c=await C(`/laba-rugi?${O}`,{headers:{Authorization:`Bearer ${$}`}});P.value=Object.entries(c.total.kredit).map(([d,f])=>({kategori:d,total:v(Number(f))})),a.value=Object.entries(c.total.debit).map(([d,f])=>({kategori:d,total:v(Number(f))})),h.value=v(c.totalBeban),x.value=v(c.totalPendapatan),S.value=v(c.labaRugi)}catch{I().danger("Gagal memuat data!")}},v=l=>l.toLocaleString("id-ID",{style:"currency",currency:s.value.mata_uang||"IDR",minimumFractionDigits:2,maximumFractionDigits:2}),E=async({start_tanggal:l=o,end_tanggal:k=o,mata_uang:w="",id_rekening:R=""}={})=>{const V={start_tanggal:l,end_tanggal:k,mata_uang:w,id_rekening:R},L={};for(const d in V){const f=V[d];f!==""&&(L[d]=String(f))}const O=new URLSearchParams(L).toString(),c=localStorage.getItem("token");try{const d=await fetch(`${ee().public.API_URL}/laba-rugi/export?${O}`,{method:"GET",headers:{Authorization:`Bearer ${c}`}});if(!d.ok)throw new Error("Gagal mengunduh PDF");const f=await d.blob(),j=window.URL.createObjectURL(f),U=document.createElement("a");U.href=j,U.download="laporan-laba-rugi.pdf",document.body.appendChild(U),U.click(),document.body.removeChild(U),window.URL.revokeObjectURL(j)}catch{I().danger("Gagal memuat data!")}},Y=async()=>{p.value=!0;const{start_tanggal:l,end_tanggal:k,mata_uang:w,id_rekening:R}=s.value;await n({start_tanggal:l||o,end_tanggal:k||o,mata_uang:w||"",id_rekening:R||""}),p.value=!1,I().success("Pencarian berhasil!")},Q=async()=>{p.value=!0;const{start_tanggal:l,end_tanggal:k,mata_uang:w,id_rekening:R}=s.value;await E({start_tanggal:l,end_tanggal:k,mata_uang:w,id_rekening:R}),p.value=!1,I().success("Export data berhasil!")},H=async()=>{p.value=!0,s.value=M(e),n(),p.value=!1,I().success("Halaman telah di refresh!")};return K(()=>{n(),b(),s.value=M(e),p.value=!1}),{fetchData:n,handleFind:Y,handleRefresh:H,handleExport:Q,rekeningOptions:F,form:s,isLoading:p,kreditItems:P,debitItems:a,totalKredit:h,totalDebit:x,labaRugi:S}}),ie={key:0,class:"w-full border-gray-300 mb-3 text-xs bg-white dark:bg-slate-800 dark:text-white"},ge={class:"px-4 py-2"},ue={class:"px-4 py-2 text-right"},ce={class:"font-bold border dark:border-gray-600"},me={class:"px-4 py-2 text-right"},pe={key:1,class:"text-sm italic text-gray-500 dark:text-gray-400 mb-4"},ke={key:2},be={class:"w-full border-gray-300 text-xs bg-white dark:bg-slate-800 dark:text-white"},fe={class:"px-4 py-2"},ye={class:"px-4 py-2 text-right"},_e={class:"font-bold border dark:border-gray-600"},he={class:"px-4 py-2 text-right"},xe={class:"font-bold text-green-800 dark:text-gray-200 my-3"},ve={key:3,class:"text-sm italic text-gray-500 dark:text-gray-400"},we={class:"grid grid-cols-2 md:grid-cols-4 gap-2 py-2"},Re={class:"grid grid-cols-3 gap-2 py-2"},Se={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Ce={class:"grid items-center text-lg w-full"},De={class:"divide-y divide-green-200 dark:divide-gray-600"},Ve=["onClick"],Le={class:"flex items-center space-x-2"},Ue={class:"text-sm font-medium text-gray-800 dark:text-gray-100"},Me=te({__name:"index",setup(P){const a=de(),h=m(!1),x=m(""),S=m(null);K(()=>{G("#tanggal-awal",{dateFormat:"Y-m-d",onChange:(o,e)=>{a.form.start_tanggal=e}}),G("#tanggal-akhir",{dateFormat:"Y-m-d",onChange:(o,e)=>{a.form.end_tanggal=e}})});const F=[{value:"IDR",name:"IDR"},{value:"USD",name:"USD"}];function $(){h.value=!0}const C=()=>{h.value=!1,x.value=""},p=ae(()=>{const o=x.value.trim().toLowerCase();return a.rekeningOptions.filter(s=>s.name.toLowerCase().includes(o)).slice(0,10)}),D=o=>{a.form.nama_rekening=o.name,a.form.id_rekening=o.value,C()};return ne(h,async o=>{var e,s,b;o&&(await le(),(b=(s=(e=S.value)==null?void 0:e.$el)==null?void 0:s.querySelector("input"))==null||b.focus())}),(o,e)=>{const s=X,b=Z;return i(),g(B,null,[t("div",null,[e[10]||(e[10]=t("h2",{class:"font-bold mb-1 text-green-800 dark:text-white"},"Pendapatan (Debit)",-1)),r(a).debitItems.length>0?(i(),g("table",ie,[e[7]||(e[7]=t("thead",{class:"bg-green-50 text-green-700 dark:bg-slate-700 dark:text-green-400"},[t("tr",{class:"border dark:border-gray-600"},[t("th",{class:"text-left px-4 py-2"},"Kategori"),t("th",{class:"text-right px-4 py-2"},"Total")])],-1)),t("tbody",null,[(i(!0),g(B,null,N(r(a).debitItems,n=>(i(),g("tr",{key:n.kategori,class:"border dark:border-gray-600"},[t("td",ge,y(n.kategori),1),t("td",ue,y(n.total),1)]))),128)),t("tr",ce,[e[6]||(e[6]=t("td",{class:"px-4 py-2"},"Total Pendapatan",-1)),t("td",me,y(r(a).totalDebit),1)])])])):(i(),g("p",pe,"Tidak ada data kredit yang tersedia untuk periode ini.")),e[11]||(e[11]=t("h2",{class:"font-bold mb-2 text-green-800 dark:text-white"},"Beban (Kredit)",-1)),r(a).kreditItems.length>0?(i(),g("div",ke,[t("table",be,[e[9]||(e[9]=t("thead",{class:"bg-green-50 text-green-700 dark:bg-slate-700 dark:text-green-400"},[t("tr",{class:"border dark:border-gray-600"},[t("th",{class:"text-left px-4 py-2"},"Kategori"),t("th",{class:"text-right px-4 py-2"},"Total")])],-1)),t("tbody",null,[(i(!0),g(B,null,N(r(a).kreditItems,n=>(i(),g("tr",{key:n.kategori,class:"border dark:border-gray-600"},[t("td",fe,y(n.kategori),1),t("td",ye,y(n.total),1)]))),128)),t("tr",_e,[e[8]||(e[8]=t("td",{class:"px-4 py-2"},"Total Beban",-1)),t("td",he,y(r(a).totalKredit),1)])])]),t("div",xe," Laba Bersih : "+y(r(a).labaRugi),1)])):(i(),g("p",ve,"Tidak ada data debit yang tersedia untuk periode ini."))]),t("div",we,[u(T,{modelValue:r(a).form.start_tanggal,"onUpdate:modelValue":e[0]||(e[0]=n=>r(a).form.start_tanggal=n),label:"Tanggal Awal",id:"tanggal-awal",placeholder:""},null,8,["modelValue"]),u(T,{modelValue:r(a).form.end_tanggal,"onUpdate:modelValue":e[1]||(e[1]=n=>r(a).form.end_tanggal=n),label:"Tanggal Akhir",id:"tanggal-akhir",placeholder:""},null,8,["modelValue"]),u(s,{modelValue:r(a).form.mata_uang,"onUpdate:modelValue":e[2]||(e[2]=n=>r(a).form.mata_uang=n),label:"Mata Uang",placeholder:"---Pilih Mata Uang---",options:F},null,8,["modelValue"]),u(T,{modelValue:r(a).form.nama_rekening,"onUpdate:modelValue":e[3]||(e[3]=n=>r(a).form.nama_rekening=n),label:"Rekening",placeholder:"",readonly:"true",onClick:e[4]||(e[4]=n=>$())},null,8,["modelValue"])]),t("div",Re,[u(r(A),{shadow:"",gradient:"green",onClick:r(a).handleRefresh},{prefix:_(()=>[u(b,{name:"material-symbols:refresh",size:"18"})]),default:_(()=>[e[12]||(e[12]=z(" Refresh "))]),_:1,__:[12]},8,["onClick"]),u(r(A),{shadow:"",gradient:"purple",onClick:r(a).handleFind},{prefix:_(()=>[u(b,{name:"material-symbols:search",size:"18"})]),default:_(()=>[e[13]||(e[13]=z(" Find "))]),_:1,__:[13]},8,["onClick"]),u(r(A),{shadow:"",gradient:"red",onClick:r(a).handleExport},{prefix:_(()=>[u(b,{name:"carbon:document-pdf",size:"18"})]),default:_(()=>[e[14]||(e[14]=z(" Export "))]),_:1,__:[14]},8,["onClick"])]),r(a).isLoading?(i(),g("div",Se,[u(r(oe),{color:"green",size:"12"})])):q("",!0),h.value?(i(),re(r(se),{key:1,onClose:C},{header:_(()=>[t("div",Ce,[u(T,{modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=n=>x.value=n),label:"Cari Rekening",ref_key:"inputRef",ref:S},null,8,["modelValue"])])]),body:_(()=>[t("ul",De,[(i(!0),g(B,null,N(r(p),(n,v)=>(i(),g("li",{key:v,onClick:E=>D(n),class:"cursor-pointer px-4 py-2 hover:bg-green-200 dark:hover:bg-gray-500 transition rounded-md"},[t("div",Le,[t("div",Ue,y(n.name),1)])],8,Ve))),128))])]),_:1})):q("",!0)],64)}}});export{Me as default};
